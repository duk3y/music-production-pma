{% extends 'base.html' %}

{% block title %}
  {{ project.name }} - Project Homepage
{% endblock %}

{% block content %}
  <div class="container-fluid" style="height: 100%;">
    <div class="row align-items-center mb-3">
      <!-- Back to My Projects Button -->
      <div class="col-auto p-3">
        <a href="{% url 'common_default' %}" class="btn btn-secondary"><i class="fa fa-arrow-left"></i> My Projects</a>
      </div>
      <!-- Project Title -->
      <div class="col text-center">
        <h1 class="mb-0">{{ project.name }}</h1>
      </div>
      <!-- Task Button -->
      <div class="col-auto p-3 text-end">
        <a href="{% url 'project_task_view' project.id %}" class="btn btn-secondary"><i class="fas fa-tasks"></i> Tasks</a>
      </div>
      {% if not project.is_private %}
        <a href="{% url 'edit_project' project.id %}" class="btn btn-primary">Edit Project</a>
      {% endif %}

      <div class="text-center">
        <h1 class="mb-0">{{ project.name }}</h1>
      </div>
    </div>

    <!-- File Management Section (Left) -->
    <div class="col-md-6 d-flex align-items-center px-4">
      <div class="table-responsive w-100">
        <h2>Project Files</h2>
        <table class="table table-dark table-striped">
          <thead>
            <tr>
              <th>File Name</th>
              <th>Uploaded By</th>
              <th>Uploaded Date</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for file in project.projectfiles_set.all %}
              <tr>
                <td>
                  <a href="{{ file.file.url }}" target="_blank">{{ file.title }}</a>
                </td>
                <td>{{ file.uploaded_by }}</td>
                <td>{{ file.created_at }}</td>
                <td>
                  <form method="post" action="{% url 'delete_file' file.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Delete</button>
                  </form>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="text-center">No files found.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        <!-- Add Files Button -->
        <div class="text-center mt-3">
          <a href="{% url 'file_upload' project.id %}" class="btn btn-primary">Add Files</a>
          <a href="{% url 'manage_files' project.id %}" class="btn btn-secondary">Manage Files</a>
        </div>
      </div>
    </div>

    <!-- Right Section with Project Deadlines and Progress Tracking -->
    <div class="col-md-6 px-4">
      <!-- Project Deadlines Section -->
      <div class="text-center mb-4 px-4">
        <h2>Project Deadlines</h2>
        <ul class="list-group">
          {% for deadline in project.deadlines %}
            <li class="list-group-item bg-dark text-light">{{ deadline.name }} - Due: {{ deadline.due_date }}</li>
          {% empty %}
            <li class="list-group-item bg-dark text-light text-center">No deadlines set.</li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <!-- Discussion and Comments Section -->
    <div class="row mt-4">
      <div class="col-md-12 p-4">
        <div class="text-center p-4">
          <h2>Discussion and Comments</h2>
          <div class="comment-section bg-dark p-3">
            {% for comment in project.comments %}
              <div class="comment my-2">
                <p>
                  <strong>{{ comment.user }}:</strong> {{ comment.text }}
                </p>
                <small class="text-muted">Posted on: {{ comment.date }}</small>
              </div>
            {% empty %}
              <p class="text-center">No comments yet. Be the first to start the discussion!</p>
            {% endfor %}
            <form method="post" action="{% url 'add_comment' project.id %}">
              {% csrf_token %}
              <div class="input-group mt-3">
                <input type="text" name="comment" class="form-control" placeholder="Add a comment..." />
                <button type="submit" class="btn btn-light">Post</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
